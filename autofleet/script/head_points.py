import numpy as np
import matplotlib.pyplot as plt
from matplotlib.patches import FancyArrowPatch

# 读取数据文件
def read_data(file_path):
    data = []
    with open(file_path, 'r') as file:
        for line in file:
            x, y, yaw = map(float, line.split())
            data.append((x, y, yaw))
    return np.array(data)

# 绘制轨迹
def plot_trajectory(data):
    fig, ax = plt.subplots(figsize=(10, 8))
    
    # 提取x, y, yaw数据
    x = data[:, 0]
    y = data[:, 1]
    yaw = data[:, 2]
    
    # 绘制轨迹线
    ax.plot(x, y, 'b-', label='Trajectory')
    
    # 绘制方向箭头
    arrow_scale = 1  # 箭头缩放因子
    for i in range(0, len(data), 1):  # 每5个点绘制一个箭头
        dx = arrow_scale * np.cos(yaw[i])
        dy = arrow_scale * np.sin(yaw[i])
        arrow = FancyArrowPatch((x[i], y[i]), (x[i] + dx, y[i] + dy),
                               arrowstyle='->', color='r', linewidth=3.0)
        ax.add_patch(arrow)
    
    # 设置图形属性
    ax.set_xlabel('X')
    ax.set_ylabel('Y')
    ax.set_title('Trajectory Plot with Yaw Directions')
    ax.grid(True)
    ax.axis('equal')  # 保持x和y轴比例相同
    ax.legend()
    
    plt.tight_layout()
    plt.show()

# 主函数
if __name__ == "__main__":
    # 假设数据保存在'trajectory_data.txt'文件中
    # 如果数据来自其他来源，可以直接创建一个包含数据的字符串
    data_str = """4.444346 -0.015026 -0.098312
4.787168 -0.083429 -0.142153
5.134795 -0.113842 -0.096481
5.460984 -0.148642 -0.096481
5.808610 -0.179055 -0.076790
6.160401 -0.202456 -0.076817
6.507778 -0.232869 -0.083637
6.847332 -0.260043 -0.049909
7.227215 -0.268805 -0.073853
7.590126 -0.315000 -0.000010
7.952579 -0.268813 0.064844
8.301371 -0.268816 0.000011
8.664436 -0.268805 0.000013
9.027205 -0.268807 0.005641
9.340119 -0.264993 0.006081
9.652787 -0.265003 -0.005785
10.002733 -0.268826 -0.005440
10.351641 -0.268805 0.005375
10.714626 -0.265000 0.099450
11.039545 -0.200167 0.144455
11.369375 -0.169754 0.010866
11.720763 -0.192764 -0.066178
12.052056 -0.214999 -0.032682
12.400552 -0.214989 0.105318
12.744832 -0.141766 0.071156
13.125620 -0.163309 -0.030787
13.478895 -0.164372 -0.002922
13.838255 -0.165391 -0.000553
14.152410 -0.164745 0.000975
14.501366 -0.164745 0.006153
14.863635 -0.160369 -0.000371
15.189769 -0.165000 -0.008441
15.493473 -0.165685 0.053322
15.845919 -0.129979 0.098572
16.192055 -0.096600 0.329431
16.452146 0.077283 0.586574
16.709684 0.247419 0.783778
16.915530 0.539167 1.041908
17.049054 0.828110 1.201761
17.147298 1.138434 1.318156
17.208851 1.447104 1.395094
17.256826 1.755378 1.390162
17.326914 2.093581 1.371056
17.396314 2.444414 1.368031
17.468969 2.784540 1.371298
17.537244 3.141437 1.395064
17.595270 3.495837 1.549725
17.552213 3.851718 0.843391"""

    # 将字符串保存到临时文件
    with open('temp_data.txt', 'w') as f:
        f.write(data_str)
    
    # 读取数据并绘制
    data = read_data('temp_data.txt')
    plot_trajectory(data)
    
    # 删除临时文件
    import os
    os.remove('temp_data.txt')
